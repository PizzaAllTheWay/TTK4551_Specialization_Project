\subsection{Feature Extraction}
\subsubsection{Landmarks}
Once the local Cartesian map has been constructed, the next step is to identify distinct and stable features on the seafloor that can act as landmarks for SLAM. These landmarks represent repeatable acoustic structures, typically strong echoes or shadows, that remain visible across consecutive local maps and can therefore be used for consistent data association and vehicle localization.  
\\ \\
The process converts the local reflectivity map into a probabilistic representation to handle sonar noise and spatial uncertainty. From this smoothed intensity field, locally dominant regions are extracted as potential landmarks based on their acoustic contrast and geometric stability. High intensity compact regions correspond to echoes from raised or reflective surfaces, while elongated low intensity areas indicate acoustic shadows caused by occlusions or terrain depressions.  
\\ \\
Each detected landmark is assigned a centroid position in the local Cartesian frame and a compact descriptor summarizing its surrounding intensity and texture pattern. These descriptors enable efficient and robust landmark matching across consecutive local maps using nearest neighbor search techniques later used in Data Association part.  
\\ \\
For integration with SLAM, every landmark is expressed as a measurement in range and bearing relative to the vehicle,  
$$
    \mathbf{z}^i = [z_r^i, z_\theta^i]^\top
$$
as defined by the measurement model in Equation \ref{eq:range-bearing-measurement-model}. This links the vehicle state to corresponding environmental landmarks through the measurement function $h_{\text{corr}}(\mathbf{x}, m^i)$ (See Equations \ref{eq:range-bearing-model-extended} and \ref{eq:range-bearing-model-deterministic}).
\\ \\
Each extracted landmark is stored together with its descriptor, position, and confidence score, forming the interface between the local mapping process and the SLAM data association stage, which determines whether the landmark corresponds to a previously known feature or a newly observed one. 
\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\linewidth]{Pictures/Local_Map_Generation/Feature_Extraction/landmark_measurement_example.png}
    \caption{Landmark detection and range-bearing formulation relative to the vehicle position.}
    \label{fig:local-map-generation-landmark-measurement-example}
\end{figure}












\subsubsection{Probabilistic Map}
To handle sonar uncertainty and speckle noise, the Cartesian reflectivity grid is converted into a probabilistic representation. Each sonar return contributes to a likelihood field centered at its ground-projected position:
\begin{equation}
    P(x, y) = \hat{R}(x, y)
    \exp\!\left(-\frac{(x - x_k)^2 + (y - y_k)^2}{2\sigma^2}\right)
\end{equation}
where $\hat{R}(x, y)$ is the normalized backscatter intensity (see Equation~\ref{eq:cartesian-mapping-knn}), and $\sigma$ defines spatial uncertainty based on sonar footprint and beam geometry.  
\\ \\
This continuous likelihood formulation smooths local variations and creates a probabilistic surface from which stable landmark features can be extracted.



\subsubsection{Landmark Detection}
Landmarks are detected by locating locally dominant responses in the probabilistic map, where the likelihood or its gradient exceeds a predefined threshold relative to neighboring cells.  
\\ \\
Two feature types are considered:
\begin{itemize}
    \item \textbf{Echo landmarks:} bright compact regions representing strong reflectors or raised objects.
    \item \textbf{Shadow landmarks:} elongated dark regions caused by acoustic occlusion or terrain depressions.
\end{itemize}
Morphological filtering removes noise and merges overlapping responses. Each valid landmark is represented by its centroid position $\mathbf{p}_L = [x_L, y_L]^\top$ in the local Cartesian map frame.



\subsubsection{Landmark Measurement}
Since both the vehicle and the landmarks are defined in the same local Cartesian frame, the vehicle origin coincides with $(0,0)$, and its heading aligns with the $x$-axis. The landmark measurement therefore simplifies to:
\begin{equation}
    \mathbf{z}^i =
    \begin{bmatrix}
        z_r^i \\ z_\theta^i
    \end{bmatrix}
    =
    \begin{bmatrix}
        \sqrt{x_L^2 + y_L^2} \\
        \mathrm{atan2}(y_L,\, x_L)
    \end{bmatrix}
\end{equation}
This gives the direct range and bearing from the vehicle to each landmark, without requiring frame transformations. The measurement $\mathbf{z}^i$ corresponds to the expected observation model $h(\mathbf{x}, \mathbf{m})$ used in SLAM (see Equation~\ref{eq:range-bearing-measurement-model}).



\subsubsection{Landmark Measurement Uncertainty}
Each measurement $\mathbf{z}^i$ is associated with a covariance matrix $\mathbf{R}_{z_i}$ describing its uncertainty in range and bearing.  
\\ \\
Following the range-dependent noise model in Equation~\ref{eq:range-bearing-model-extended-noise}, the covariance is:
\begin{equation}
    \mathbf{R}_{z_i} =
    \begin{bmatrix}
        \sigma_r^2(1 + \alpha_r z_r^{i\,2}) & 0 \\
        0 & \sigma_\theta^2(1 + \alpha_\theta z_r^{i\,2})
    \end{bmatrix}
\end{equation}
where $\sigma_r$ and $\sigma_\theta$ represent the base noise levels, while $\alpha_r$ and $\alpha_\theta$ account for the range-dependent increase in uncertainty caused by beam spreading and acoustic attenuation.



\subsubsection{Descriptor Assignment}
Each detected landmark is assigned a descriptor encoding its local reflectivity and texture characteristics:
\begin{equation}
    \mathbf{d}_L = [\mu_I,\, \sigma_I,\, \nabla I_x,\, \nabla I_y,\, \text{entropy},\, \text{contrast}]
\end{equation}
where $\mu_I$ and $\sigma_I$ are the mean and variance of the intensity patch around the landmark. These descriptors allow for efficient nearest-neighbor matching using FLANN or similar kNN-based methods, enabling fast and robust feature association between consecutive local maps.



\subsubsection{Landmark Output}
The final output of the feature extraction module consists of validated landmarks, each described by:
\[
    \mathcal{L}_i = \{\mathbf{z}^i,\, \mathbf{R}_{z_i},\, \mathbf{d}_L\}
\]
This minimal representation provides all required information for the SLAM data association and correction stepsâ€”measurement, uncertainty, and a descriptor for efficient matching. The data association module later determines whether each new observation corresponds to an existing landmark or a newly discovered feature.
